---
description:
globs:
alwaysApply: false
---
# WebPrinter ì›¹ í†µí•© ê°€ì´ë“œ

## ê¸°ë³¸ í†µí•© íŒ¨í„´

### 1ë‹¨ê³„: í”„ë¡œí† ì½œ í˜¸ì¶œ
```javascript
// WebPrinter ì•± ì‹¤í–‰ (ì„¸ì…˜ IDì™€ í•¨ê»˜)
const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
window.location.href = `webprinter://print?session=${sessionId}`;
```

### 2ë‹¨ê³„: ì„œë²„ íƒì§€
```javascript
// [web-example.html](mdc:web-example.html) íŒ¨í„´ ì°¸ê³ 
async function findWebPrinterServer() {
    const ports = [18731, 18732, 18733, 18734, 18735];
    
    for (const port of ports) {
        try {
            const response = await fetch(`http://localhost:${port}/status`, {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.status === 'running' && data.name === 'WebPrinter') {
                    return port;
                }
            }
        } catch (error) {
            continue; // ë‹¤ìŒ í¬íŠ¸ ì‹œë„
        }
    }
    return null;
}
```

### 3ë‹¨ê³„: ì¸ì‡„ ë°ì´í„° ì „ì†¡
```javascript
async function sendPrintData(port, sessionId, previewUrl, printUrl, width, height) {
    const response = await fetch(`http://localhost:${port}/send-urls`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            session_id: sessionId,
            preview_url: previewUrl,
            print_url: printUrl,
            paper_width: parseFloat(width),
            paper_height: parseFloat(height),
            paper_size: `${width}mm x ${height}mm`
        })
    });
    
    return response.ok;
}
```

## ì™„ì „í•œ í†µí•© ì˜ˆì œ

### HTML êµ¬ì¡°
```html
<!-- [web-example.html](mdc:web-example.html) ê¸°ë°˜ -->
<div class="container">
    <div class="input-group">
        <label>ë¯¸ë¦¬ë³´ê¸° URL:</label>
        <input type="url" id="preview-url" value="https://print-seven-nu.vercel.app/preview.html">
    </div>
    
    <div class="input-group">
        <label>ì¸ì‡„ URL:</label>
        <input type="url" id="print-url" value="https://print-seven-nu.vercel.app/print.html">
    </div>
    
    <div class="size-inputs">
        <div class="input-group">
            <label>ê°€ë¡œ (mm):</label>
            <input type="number" id="paper-width" value="244">
        </div>
        <div class="input-group">
            <label>ì„¸ë¡œ (mm):</label>
            <input type="number" id="paper-height" value="88">
        </div>
    </div>
    
    <button onclick="startPrint()">ğŸ–¨ï¸ ì¶œë ¥í•˜ê¸°</button>
</div>
```

### JavaScript í†µí•© í•¨ìˆ˜
```javascript
async function startPrint() {
    // 1. ì…ë ¥ê°’ ìˆ˜ì§‘
    const previewUrl = document.getElementById('preview-url').value;
    const printUrl = document.getElementById('print-url').value;
    const width = document.getElementById('paper-width').value;
    const height = document.getElementById('paper-height').value;
    
    // 2. ì„¸ì…˜ ID ìƒì„±
    const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    // 3. WebPrinter ì‹¤í–‰
    window.location.href = `webprinter://print?session=${sessionId}`;
    
    // 4. ì„œë²„ ì—°ê²° ëŒ€ê¸° ë° ë°ì´í„° ì „ì†¡
    setTimeout(async () => {
        const port = await findWebPrinterServer();
        if (port) {
            const success = await sendUrlsToWebPrinter(port, sessionId, previewUrl, printUrl, width, height);
            if (success) {
                showStatus('âœ… ì¸ì‡„ ë°ì´í„°ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                showStatus('âŒ ë°ì´í„° ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } else {
            showInstallGuide();
        }
    }, 2000);
}
```

## OSë³„ ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ

### OS ê°ì§€ ë¡œì§
```javascript
function detectOS() {
    const userAgent = navigator.userAgent;
    const userAgentLower = userAgent.toLowerCase();
    const platform = navigator.platform.toLowerCase();
    
    // macOS ê°ì§€
    if (platform.includes('mac') || userAgentLower.includes('mac')) {
        // Intel vs Apple Silicon êµ¬ë¶„
        const isIntelMac = userAgent.includes('Intel Mac OS X') || 
                          userAgentLower.includes('intel');
        return isIntelMac ? 'mac-intel' : 'mac-arm64';
    }
    
    // Windows ê°ì§€
    if (platform.includes('win') || userAgentLower.includes('windows')) {
        return 'windows';
    }
    
    return 'unknown';
}
```

### GitHub Releases ì—°ë™
```javascript
async function loadDownloadLinks() {
    try {
        const response = await fetch('https://api.github.com/repos/code-x-team/webprint-electron/releases/latest');
        const release = await response.json();
        const os = detectOS();
        
        let downloadHtml = '';
        
        if (os === 'mac-intel' || os === 'mac-arm64') {
            // macOS ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
            const armAsset = release.assets.find(asset => 
                asset.name.includes('.dmg') && asset.name.includes('arm64'));
            const intelAsset = release.assets.find(asset => 
                asset.name.includes('.dmg') && !asset.name.includes('arm64'));
                
            // OSì— ë”°ë¼ ìš°ì„  ì¶”ì²œ ë²„ì „ í‘œì‹œ
            if (os === 'mac-intel' && intelAsset) {
                downloadHtml += createDownloadButton(intelAsset, 'ğŸ’» Intel Mac (ê¶Œì¥)', 'primary');
                if (armAsset) {
                    downloadHtml += createDownloadButton(armAsset, 'ğŸš€ Apple Silicon', 'secondary');
                }
            } else if (armAsset) {
                downloadHtml += createDownloadButton(armAsset, 'ğŸš€ Apple Silicon (ê¶Œì¥)', 'primary');
                if (intelAsset) {
                    downloadHtml += createDownloadButton(intelAsset, 'ğŸ’» Intel Mac', 'secondary');
                }
            }
        } else if (os === 'windows') {
            // Windows ë‹¤ìš´ë¡œë“œ ë§í¬
            const winAsset = release.assets.find(asset => asset.name.includes('.exe'));
            if (winAsset) {
                downloadHtml += createDownloadButton(winAsset, 'ğŸªŸ Windows', 'primary');
            }
        }
        
        document.getElementById('download-links').innerHTML = downloadHtml;
    } catch (error) {
        console.error('Failed to load download links:', error);
    }
}

function createDownloadButton(asset, label, type) {
    const isPrimary = type === 'primary';
    const style = isPrimary 
        ? 'display: inline-block; margin: 5px 10px 5px 0; padding: 10px 20px; background: #007AFF; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;'
        : 'margin-left: 10px; padding: 6px 12px; background: #666; color: white; text-decoration: none; border-radius: 4px;';
        
    const size = (asset.size / 1024 / 1024).toFixed(1);
    
    return `
        <a href="${asset.browser_download_url}" 
           style="${style}"
           target="_blank">
            ${label} - ${size}MB
        </a>`;
}
```

## ë²„ì „ í™•ì¸ ë° ì—…ë°ì´íŠ¸ ì•ˆë‚´

### í˜„ì¬ ì„¤ì¹˜ëœ ë²„ì „ í™•ì¸
```javascript
async function checkInstalledVersion() {
    try {
        const port = await findWebPrinterServer();
        if (port) {
            const response = await fetch(`http://localhost:${port}/status`);
            const data = await response.json();
            return data.version;
        }
    } catch (error) {
        console.error('Failed to get installed version:', error);
    }
    return null;
}
```

### ìµœì‹  ë²„ì „ê³¼ ë¹„êµ
```javascript
async function checkForUpdates() {
    const [installedVersion, latestRelease] = await Promise.all([
        checkInstalledVersion(),
        fetch('https://api.github.com/repos/code-x-team/webprint-electron/releases/latest').then(r => r.json())
    ]);
    
    if (installedVersion && latestRelease) {
        const latestVersion = latestRelease.tag_name.replace('v', '');
        
        if (installedVersion !== latestVersion) {
            showUpdateNotification(installedVersion, latestVersion);
        } else {
            showVersionStatus(`âœ… ìµœì‹  ë²„ì „ (v${installedVersion}) ì‚¬ìš© ì¤‘`);
        }
    }
}
```

## ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

### ì—°ê²° ì‹¤íŒ¨ ì²˜ë¦¬
```javascript
async function handleConnectionError() {
    const isInstalled = await checkIfAppInstalled();
    
    if (!isInstalled) {
        showInstallGuide();
    } else {
        showTroubleshootingGuide();
    }
}

function showTroubleshootingGuide() {
    const guide = `
        <div class="troubleshooting">
            <h3>ğŸ”§ ë¬¸ì œ í•´ê²°</h3>
            <p>WebPrinterê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ë§Œ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:</p>
            <ul>
                <li>WebPrinterë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”</li>
                <li>ë°©í™”ë²½ì—ì„œ ë¡œì»¬ ì—°ê²°ì„ í—ˆìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</li>
                <li>ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”</li>
            </ul>
        </div>
    `;
    document.getElementById('status-message').innerHTML = guide;
}
```

## API ëª…ì„¸

### POST /send-urls
**ìš”ì²­ ë³¸ë¬¸**:
```json
{
    "session_id": "session_1234567890_abc123",
    "preview_url": "https://example.com/preview.html",
    "print_url": "https://example.com/print.html", 
    "paper_width": 244,
    "paper_height": 88,
    "paper_size": "244mm x 88mm"
}
```

**ì‘ë‹µ**:
```json
{
    "message": "URLs received successfully",
    "session_id": "session_1234567890_abc123"
}
```

### GET /status
**ì‘ë‹µ**:
```json
{
    "status": "running",
    "name": "WebPrinter",
    "version": "1.1.0"
}
```
